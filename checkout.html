<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - Gamer's Auction</title>

<!-- Razorpay Checkout -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body {margin:0; font-family:Arial,sans-serif; background:#fff5f5; color:#111;}
header {background: rgba(0,0,0,0.85); padding:0.75rem 2rem; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:1000;}
header img {height:70px;}
nav a {color:#fff; text-decoration:none; margin-left:1.5rem; font-weight:bold; transition:0.3s;}
nav a:hover {color:#ff4d4d;}
#googleSignIn{margin-left:auto;}
.checkout-container{max-width:900px; margin:3rem auto; padding:2rem; background:#fff; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.checkout-container h2{text-align:center; margin-bottom:2rem; color:#cc0000;}
.checkout-item{display:flex; justify-content:space-between; padding:1rem 0; border-bottom:1px solid #ccc;}
.checkout-item p{margin:0;}
.pay-btn{background:#ff4d4d; color:#fff; border:none; padding:0.75rem 1.5rem; border-radius:5px; font-size:1rem; cursor:pointer; transition:0.3s; width:100%; margin-top:1rem;}
.pay-btn:hover{background:#e60000;}
footer{text-align:center; padding:2rem 1rem; background:#000; color:#fff; margin-top:3rem;}
footer a{color:#ff4d4d; text-decoration:none; font-weight:bold; margin:0 0.5rem;}
footer a:hover{text-decoration:underline;}
</style>
</head>
<body>

<header>
<img src="image_2025-09-09_095842205.png" alt="Logo">
<nav>
<a href="index.html">Home</a>
<a href="shop.html">Shop</a>
<a href="cart.html">Cart</a>
<a href="checkout.html">Checkout</a>
</nav>
<div id="googleSignIn"></div>
</header>

<div class="checkout-container">
<h2>Checkout</h2>
<div id="cartItemsContainer"></div>
<label for="payment">Payment Method</label>
<select id="payment">
<option value="razorpay">Razorpay (UPI/Cards/Wallet)</option>
<option value="cod">Cash on Delivery</option>
</select>
<button class="pay-btn" id="payBtn">Pay Now</button>
</div>

<footer>
<p>&copy; 2025 Gamer's Auction. All Rights Reserved.</p>
<p>
Visit <a href="https://gamerstech.vercel.app" target="_blank">Gamerstech</a> |
Watch on <a href="https://www.youtube.com/@ItzDareYT" target="_blank">YouTube</a>
</p>
</footer>

<script>
// Decode JWT
function decodeJwtResponse(token){
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
    return JSON.parse(atob(base64));
}

// Load user and cart
let currentUser = JSON.parse(localStorage.getItem("currentUser") || "null");
let cart = JSON.parse(localStorage.getItem("checkoutItems") || "[]");

// Google Sign-In
function handleCredentialResponse(response){
    const userObject = decodeJwtResponse(response.credential);
    currentUser = {email:userObject.email, name:userObject.name, picture:userObject.picture};
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
}

// Initialize Google Sign-In
window.onload=function(){
    google.accounts.id.initialize({
        client_id: "189925870813-9ipif2qvi3vkv4f7lsh4p0e4kg644t64.apps.googleusercontent.com",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(document.getElementById("googleSignIn"), {theme:"outline", size:"large"});
    renderCartItems();
}

// Render Cart Items
function renderCartItems(){
    if(!currentUser){
        alert("Sign in to proceed with checkout.");
        window.location.href="index.html";
        return;
    }

    const container = document.getElementById("cartItemsContainer");
    if(cart.length===0){
        container.innerHTML="<p>Your cart is empty.</p>";
        document.getElementById("payBtn").style.display="none";
        return;
    }
    container.innerHTML="";
    cart.forEach(item=>{
        const div = document.createElement("div");
        div.className="checkout-item";
        div.innerHTML=`<p>${item.title} - $${item.price}</p><p>Seller: ${item.displayName}</p>`;
        container.appendChild(div);
    });
}

// Pay Button
document.getElementById("payBtn").addEventListener("click",()=>{
    const paymentMethod = document.getElementById("payment").value;
    if(paymentMethod==="cod"){
        completePurchase("COD");
    }else{
        const total = cart.reduce((sum,item)=>sum+Number(item.price),0)*100; // in paise
        const options = {
            "key":"YOUR_RAZORPAY_KEY", // <-- replace with your Razorpay key
            "amount": total,
            "currency":"INR",
            "name":"Gamer's Auction",
            "description":"Purchase Items",
            "handler": function (response){
                completePurchase("Razorpay");
            }
        };
        const rzp1 = new Razorpay(options);
        rzp1.open();
    }
});

// Complete purchase
function completePurchase(method){
    // Notify sellers
    const allProducts = JSON.parse(localStorage.getItem("products") || "[]");
    cart.forEach(item=>{
        const sellerNotifications = JSON.parse(localStorage.getItem("sellerNotifications")||"{}");
        if(!sellerNotifications[item.sellerEmail]) sellerNotifications[item.sellerEmail]=[];
        sellerNotifications[item.sellerEmail].push({
            productTitle:item.title,
            buyer:currentUser.name,
            method:method
        });
        localStorage.setItem("sellerNotifications", JSON.stringify(sellerNotifications));
    });
    alert("Purchase successful! Payment method: " + method);
    // Clear cart
    localStorage.removeItem("cart");
    localStorage.removeItem("checkoutItems");
    window.location.href="shop.html";
}
</script>

</body>
</html>
