<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seller Dashboard - Gamer's Auction</title>

<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body {margin:0; font-family:Arial,sans-serif; background:#111; color:#fff;}
header {background: rgba(0,0,0,0.85); padding:0.75rem 2rem; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:1000;}
header img {height:70px;}
nav a {color:#fff; text-decoration:none; margin-left:1.5rem; font-weight:bold; transition:0.3s;}
nav a:hover {color:#ff4d4d;}
.container{max-width:900px; margin:2rem auto; padding:2rem; background:#222; border-radius:10px;}
h2{text-align:center; color:#ff4d4d; margin-bottom:1.5rem;}
form label{display:block; margin-bottom:0.5rem;}
form input, form textarea{width:100%; padding:0.75rem; margin-bottom:1rem; border-radius:5px; border:none;}
form button{background:#ff4d4d; color:#fff; border:none; padding:0.75rem 1.5rem; cursor:pointer; border-radius:5px; font-size:1rem;}
.products-list{margin-top:2rem;}
.product-item{background:#333; padding:1rem; border-radius:5px; margin-bottom:1rem; display:flex; align-items:center;}
.product-item img{height:80px; width:80px; object-fit:cover; margin-right:1rem; border-radius:5px;}
.product-item div{flex:1;}
.product-item div p{margin:0.2rem 0;}
#googleSignIn{margin-left:auto;}
</style>
</head>
<body>

<header>
<img src="image_2025-09-09_095842205.png" alt="Logo">
<nav>
<a href="index.html">Home</a>
<a href="shop.html">Shop</a>
<a href="cart.html">Cart</a>
<a href="checkout.html">Checkout</a>
</nav>
<div id="googleSignIn"></div>
</header>

<div class="container">
<h2>Seller Dashboard</h2>

<div id="signInNotice">
<p>You must sign in to upload products.</p>
</div>

<div id="sellerForm" style="display:none;">
<form id="uploadForm">
<label for="displayName">Display Name (shown to buyers)</label>
<input type="text" id="displayName" required>

<label for="title">Product Title</label>
<input type="text" id="title" required>

<label for="price">Price ($)</label>
<input type="number" id="price" required>

<label for="image">Upload Image</label>
<input type="file" id="image" accept="image/*" required>

<button type="submit">Upload Product</button>
</form>
</div>

<div class="products-list" id="productsList"></div>
</div>

<script>
// Decode JWT
function decodeJwtResponse(token){
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
    return JSON.parse(atob(base64));
}

// Load current user from localStorage
let currentUser = JSON.parse(localStorage.getItem("currentUser") || "null");

// Google Sign-In
function handleCredentialResponse(response){
    const userObject = decodeJwtResponse(response.credential);
    currentUser = {
        email:userObject.email,
        name:userObject.name,
        picture:userObject.picture
    };
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
    updateSignInState();
}

// Update UI after sign-in
function updateSignInState(){
    if(currentUser){
        document.getElementById("googleSignIn").style.display="none";
        document.getElementById("signInNotice").style.display="none";
        document.getElementById("sellerForm").style.display="block";
        displayProducts();
    }
}

// Upload product
document.getElementById("uploadForm").addEventListener("submit", function(e){
    e.preventDefault();
    const displayName = document.getElementById("displayName").value;
    const title = document.getElementById("title").value;
    const price = document.getElementById("price").value;
    const imageFile = document.getElementById("image").files[0];

    if(!imageFile) return;

    const reader = new FileReader();
    reader.onload = function(){
        const product = {
            sellerEmail: currentUser.email,
            displayName,
            title,
            price,
            image: reader.result
        };
        let allProducts = JSON.parse(localStorage.getItem("products") || "[]");
        allProducts.push(product);
        localStorage.setItem("products", JSON.stringify(allProducts));
        alert("Product uploaded!");
        document.getElementById("uploadForm").reset();
        displayProducts();
    };
    reader.readAsDataURL(imageFile);
});

// Display seller's products
function displayProducts(){
    const allProducts = JSON.parse(localStorage.getItem("products") || "[]");
    const sellerProducts = allProducts.filter(p=>p.sellerEmail === currentUser.email);
    const container = document.getElementById("productsList");
    container.innerHTML = "";
    if(sellerProducts.length===0) container.innerHTML="<p>No products uploaded yet.</p>";
    sellerProducts.forEach(p=>{
        const div = document.createElement("div");
        div.className="product-item";
        div.innerHTML = `<img src="${p.image}" alt="${p.title}">
                         <div><p><strong>${p.title}</strong></p>
                         <p>Price: $${p.price}</p>
                         <p>By: ${p.displayName}</p></div>`;
        container.appendChild(div);
    });
}

// Initialize Google Sign-In
window.onload = function(){
    if(currentUser) updateSignInState();
    google.accounts.id.initialize({
        client_id: "189925870813-9ipif2qvi3vkv4f7lsh4p0e4kg644t64.apps.googleusercontent.com",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(document.getElementById("googleSignIn"), {theme:"outline", size:"large"});
}
</script>

</body>
</html>
