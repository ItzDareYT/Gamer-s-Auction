<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shop - Gamer's Auction</title>

<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body {margin:0; font-family:Arial,sans-serif; background:#111; color:#fff;}
header {background: rgba(0,0,0,0.85); padding:0.75rem 2rem; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:1000;}
header img {height:70px;}
nav a {color:#fff; text-decoration:none; margin-left:1.5rem; font-weight:bold; transition:0.3s;}
nav a:hover {color:#ff4d4d;}
#googleSignIn{margin-left:auto;}
.container{max-width:1000px; margin:2rem auto; display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1rem;}
.product-card{background:#222; border-radius:10px; padding:1rem; text-align:center;}
.product-card img{width:100%; height:150px; object-fit:cover; border-radius:5px; margin-bottom:0.5rem;}
.product-card h4{margin:0.5rem 0;}
.product-card p{margin:0.2rem 0;}
.product-card button{background:#ff4d4d; border:none; color:#fff; padding:0.5rem 1rem; border-radius:5px; cursor:pointer;}
.product-card button:hover{background:#e60000;}
#signInNotice{text-align:center; margin-top:2rem; color:#ff4d4d;}
</style>
</head>
<body>

<header>
<img src="image_2025-09-09_095842205.png" alt="Logo">
<nav>
<a href="index.html">Home</a>
<a href="shop.html">Shop</a>
<a href="cart.html">Cart</a>
<a href="checkout.html">Checkout</a>
</nav>
<div id="googleSignIn"></div>
</header>

<div id="signInNotice"></div>
<div class="container" id="productsContainer"></div>

<script>
// Decode JWT
function decodeJwtResponse(token){
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
    return JSON.parse(atob(base64));
}

// Load user and cart
let currentUser = JSON.parse(localStorage.getItem("currentUser") || "null");
let cart = JSON.parse(localStorage.getItem("cart") || "[]");

// Google Sign-In callback
function handleCredentialResponse(response){
    const userObject = decodeJwtResponse(response.credential);
    currentUser = {email:userObject.email, name:userObject.name, picture:userObject.picture};
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
    renderProducts();
}

// Render products
function renderProducts(){
    const container = document.getElementById("productsContainer");
    const notice = document.getElementById("signInNotice");
    const allProducts = JSON.parse(localStorage.getItem("products") || "[]");

    if(!currentUser){
        notice.textContent = "Sign in to browse products and add to cart.";
        container.innerHTML = "";
        return;
    }
    notice.textContent = "";
    container.innerHTML = "";
    allProducts.forEach((p,index)=>{
        if(p.sellerEmail === currentUser.email) return; // hide seller's own products
        const card = document.createElement("div");
        card.className="product-card";
        card.innerHTML = `
            <img src="${p.image}" alt="${p.title}">
            <h4>${p.title}</h4>
            <p>Price: $${p.price}</p>
            <p>Seller: ${p.displayName}</p>
            <button onclick="addToCart(${index})">Add to Cart</button>
        `;
        container.appendChild(card);
    });
}

// Add product to cart
function addToCart(productIndex){
    const allProducts = JSON.parse(localStorage.getItem("products") || "[]");
    const product = allProducts[productIndex];
    cart.push(product);
    localStorage.setItem("cart", JSON.stringify(cart));
    alert("Added to cart!");
}

// Initialize Google Sign-In
window.onload = function(){
    google.accounts.id.initialize({
        client_id: "189925870813-9ipif2qvi3vkv4f7lsh4p0e4kg644t64.apps.googleusercontent.com",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(document.getElementById("googleSignIn"), {theme:"outline", size:"large"});

    if(currentUser) renderProducts();
}
</script>

</body>
</html>
